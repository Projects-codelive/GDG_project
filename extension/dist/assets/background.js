chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"save_to_linko",title:"Save to Linko",contexts:["page","link","selection","image"]})});chrome.contextMenus.onClicked.addListener((e,s)=>{e.menuItemId==="save_to_linko"&&chrome.tabs.sendMessage(s.id,{action:"scrape_and_save",info:e},t=>{chrome.runtime.lastError&&console.log("Content script not ready or not supported")})});chrome.runtime.onMessage.addListener((e,s,t)=>{if(e.action==="save_post")return n(e.data).then(o=>{t(o),chrome.notifications.create({type:"basic",iconUrl:"icons/icon48.png",title:o.success?"Linko - Saved!":"Linko - Error",message:o.message,priority:2})}),!0});async function n(e){try{const{token:s}=await chrome.storage.local.get("token");if(!s)return{success:!1,message:"Please login first"};const t=await fetch("http://localhost:5001/api/posts",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(e)});return t.ok?{success:!0,message:"Post saved!"}:{success:!1,message:(await t.json()).error||"Failed to save"}}catch(s){return{success:!1,message:s.message}}}
