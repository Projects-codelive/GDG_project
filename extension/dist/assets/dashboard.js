import{r as f,j as a,c as I,R as O}from"./client.js";/* empty css     */const D=!("chrome"in window&&chrome.storage&&chrome.storage.local);D&&(window.chrome=window.chrome||{},window.chrome.storage={local:{get:(e,t)=>{const r={};return Array.isArray(e)?e.forEach(s=>r[s]=localStorage.getItem(s)):typeof e=="string"&&(r[e]=localStorage.getItem(e)),t&&t(r),Promise.resolve(r)},set:(e,t)=>(Object.keys(e).forEach(r=>localStorage.setItem(r,e[r])),t&&t(),Promise.resolve()),remove:(e,t)=>(Array.isArray(e)?e.forEach(r=>localStorage.removeItem(r)):localStorage.removeItem(e),t&&t(),Promise.resolve())}},window.chrome.runtime={sendMessage:()=>{},onMessage:{addListener:()=>{}}});const k=f.createContext(null),L=({children:e})=>{const[t,r]=f.useState(null),[s,o]=f.useState(!0);f.useEffect(()=>{chrome.storage.local.get(["token","username"],c=>{c.token&&r({username:c.username}),o(!1)})},[]);const l=(c,m)=>{chrome.storage.local.set({token:c,username:m},()=>{r({username:m})})},n=()=>{chrome.storage.local.remove(["token","username"],()=>{r(null)})};return a.jsx(k.Provider,{value:{user:t,loading:s,login:l,logout:n},children:e})},R=()=>f.useContext(k),E="http://localhost:5000/api",x={get:async e=>{const t=await A(),r=await fetch(`${E}${e}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});return v(r)},post:async(e,t)=>{const r=await A(),s=await fetch(`${E}${e}`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(t)});return v(s)},delete:async e=>{const t=await A(),r=await fetch(`${E}${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});return v(r)}};async function A(){return(await chrome.storage.local.get(["token"])).token}async function v(e){if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.error||"Request failed")}return e.json()}function U({selectedDirectory:e,onSelectDirectory:t}){const[r,s]=f.useState([]),[o,l]=f.useState(""),{logout:n}=R();f.useEffect(()=>{c()},[]);const c=async()=>{try{const i=await x.get("/directories");s(i)}catch(i){console.error(i),(i.message.includes("Invalid token")||i.message.includes("Access denied"))&&n()}},m=async i=>{if(i.preventDefault(),!!o.trim())try{await x.post("/directories",{name:o}),l(""),c()}catch(u){alert(u.message)}},h=async(i,u)=>{if(u.stopPropagation(),!!confirm("Delete directory?"))try{await x.delete(`/directories/${i}`),e===i&&t(null),c()}catch(b){alert(b.message)}};return a.jsxs("div",{className:"w-64 bg-white dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 h-screen flex flex-col",children:[a.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:a.jsx("h1",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary",children:"Linko"})}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[a.jsx("div",{onClick:()=>t(null),className:`p-2 rounded cursor-pointer mb-1 ${e?"hover:bg-slate-50 dark:hover:bg-slate-700":"bg-indigo-50 text-indigo-600 dark:bg-slate-700 dark:text-indigo-400"}`,children:"All Posts"}),a.jsx("div",{onClick:()=>t("uncategorized"),className:`p-2 rounded cursor-pointer mb-4 ${e==="uncategorized"?"bg-indigo-50 text-indigo-600 dark:bg-slate-700 dark:text-indigo-400":"hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:"Uncategorized"}),a.jsx("p",{className:"px-2 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2",children:"Directories"}),r.map(i=>a.jsxs("div",{onClick:()=>t(i._id),className:`group p-2 rounded cursor-pointer mb-1 flex justify-between items-center ${e===i._id?"bg-indigo-50 text-indigo-600 dark:bg-slate-700 dark:text-indigo-400":"hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:[a.jsx("span",{className:"truncate",children:i.name}),a.jsx("button",{onClick:u=>h(i._id,u),className:"opacity-0 group-hover:opacity-100 text-slate-400 hover:text-red-500",children:"×"})]},i._id))]}),a.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700",children:a.jsxs("form",{onSubmit:m,className:"flex gap-2",children:[a.jsx("input",{type:"text",placeholder:"New Directory",className:"flex-1 min-w-0 p-1 px-2 text-sm border rounded dark:bg-slate-900 dark:border-slate-600",value:o,onChange:i=>l(i.target.value)}),a.jsx("button",{type:"submit",className:"text-primary hover:text-indigo-700 text-xl font-bold",children:"+"})]})})]})}function K({directoryId:e}){const[t,r]=f.useState([]),{logout:s}=R();f.useEffect(()=>{o()},[e]);const o=async()=>{try{const n=e?`?directoryId=${e}`:"",c=await x.get(`/posts${n}`);r(c)}catch(n){console.error(n),(n.message.includes("Invalid token")||n.message.includes("Access denied"))&&s()}},l=async n=>{if(confirm("Delete post?"))try{await x.delete(`/posts/${n}`),r(t.filter(c=>c._id!==n))}catch(c){alert(c.message)}};return a.jsxs("div",{className:"flex-1 p-8 overflow-y-auto bg-slate-50 dark:bg-slate-900/50",children:[a.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Saved Posts"}),t.length===0?a.jsx("div",{className:"text-center text-slate-400 mt-20",children:a.jsx("p",{children:"No posts found. Start saving from social media!"})}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:t.map(n=>a.jsxs("div",{onClick:()=>window.open(n.originalUrl,"_blank"),className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm hover:shadow-md transition-shadow overflow-hidden border border-slate-100 dark:border-slate-700 flex flex-col cursor-pointer group",children:[n.imageUrl&&a.jsx("div",{className:"h-40 bg-slate-200 w-full overflow-hidden",children:a.jsx("img",{src:n.imageUrl,alt:"Content",className:"w-full h-full object-cover transition-transform group-hover:scale-105"})}),a.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full capitalize ${n.platform==="linkedin"?"bg-blue-100 text-blue-700":n.platform==="twitter"?"bg-sky-100 text-sky-700":n.platform==="instagram"?"bg-pink-100 text-pink-700":"bg-gray-100 text-gray-700"}`,children:n.platform}),a.jsx("span",{className:"text-xs text-slate-400",children:new Date(n.savedAt).toLocaleDateString()})]}),n.authorName&&a.jsxs("div",{className:"font-semibold text-sm mb-1",children:[n.authorName," ",a.jsxs("span",{className:"text-slate-400 font-normal",children:["@",n.authorHandle||""]})]}),a.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-4 line-clamp-3",children:n.content}),a.jsxs("div",{className:"mt-auto flex justify-between items-center pt-2 border-t border-slate-100 dark:border-slate-700",children:[a.jsx("span",{className:"text-xs text-primary group-hover:underline",children:"View Post →"}),a.jsx("button",{onClick:c=>{c.stopPropagation(),l(n._id)},className:"text-slate-400 hover:text-red-500 p-1 hover:bg-slate-100 rounded",title:"Delete Post",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]},n._id))})]})}function p(e){const t=new Uint8Array(e);let r="";for(const o of t)r+=String.fromCharCode(o);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function y(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4,s=t.padEnd(t.length+r,"="),o=atob(s),l=new ArrayBuffer(o.length),n=new Uint8Array(l);for(let c=0;c<o.length;c++)n[c]=o.charCodeAt(c);return l}function j(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function P(e){const{id:t}=e;return{...e,id:y(t),transports:e.transports}}function S(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}class g extends Error{constructor({message:t,code:r,cause:s,name:o}){super(t,{cause:s}),this.name=o??s.name,this.code=r}}function $({error:e,options:t}){var s,o;const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new g({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((s=r.authenticatorSelection)==null?void 0:s.requireResidentKey)===!0)return new g({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(((o=r.authenticatorSelection)==null?void 0:o.userVerification)==="required")return new g({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new g({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new g({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return r.pubKeyCredParams.filter(n=>n.type==="public-key").length===0?new g({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new g({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const l=window.location.hostname;if(S(l)){if(r.rp.id!==l)return new g({message:`The RP ID "${r.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new g({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(r.user.id.byteLength<1||r.user.id.byteLength>64)return new g({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new g({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}class B{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const C=new B,M=["cross-platform","platform"];function _(e){if(e&&!(M.indexOf(e)<0))return e}async function H(e){var b;if(!j())throw new Error("WebAuthn is not supported in this browser");const r={publicKey:{...e,challenge:y(e.challenge),user:{...e.user,id:y(e.user.id)},excludeCredentials:(b=e.excludeCredentials)==null?void 0:b.map(P)}};r.signal=C.createNewAbortSignal();let s;try{s=await navigator.credentials.create(r)}catch(d){throw $({error:d,options:r})}if(!s)throw new Error("Registration was not completed");const{id:o,rawId:l,response:n,type:c}=s;let m;typeof n.getTransports=="function"&&(m=n.getTransports());let h;if(typeof n.getPublicKeyAlgorithm=="function")try{h=n.getPublicKeyAlgorithm()}catch(d){N("getPublicKeyAlgorithm()",d)}let i;if(typeof n.getPublicKey=="function")try{const d=n.getPublicKey();d!==null&&(i=p(d))}catch(d){N("getPublicKey()",d)}let u;if(typeof n.getAuthenticatorData=="function")try{u=p(n.getAuthenticatorData())}catch(d){N("getAuthenticatorData()",d)}return{id:o,rawId:p(l),response:{attestationObject:p(n.attestationObject),clientDataJSON:p(n.clientDataJSON),transports:m,publicKeyAlgorithm:h,publicKey:i,authenticatorData:u},type:c,clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:_(s.authenticatorAttachment)}}function N(e,t){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${e}. You should report this error to them.
`,t)}function V(){if(!j())return new Promise(t=>t(!1));const e=window.PublicKeyCredential;return e.isConditionalMediationAvailable===void 0?new Promise(t=>t(!1)):e.isConditionalMediationAvailable()}function W({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new g({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new g({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const s=window.location.hostname;if(S(s)){if(r.rpId!==s)return new g({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new g({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new g({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return e}async function z(e,t=!1){var u,b;if(!j())throw new Error("WebAuthn is not supported in this browser");let r;((u=e.allowCredentials)==null?void 0:u.length)!==0&&(r=(b=e.allowCredentials)==null?void 0:b.map(P));const s={...e,challenge:y(e.challenge),allowCredentials:r},o={};if(t){if(!await V())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');o.mediation="conditional",s.allowCredentials=[]}o.publicKey=s,o.signal=C.createNewAbortSignal();let l;try{l=await navigator.credentials.get(o)}catch(d){throw W({error:d,options:o})}if(!l)throw new Error("Authentication was not completed");const{id:n,rawId:c,response:m,type:h}=l;let i;return m.userHandle&&(i=p(m.userHandle)),{id:n,rawId:p(c),response:{authenticatorData:p(m.authenticatorData),clientDataJSON:p(m.clientDataJSON),signature:p(m.signature),userHandle:i},type:h,clientExtensionResults:l.getClientExtensionResults(),authenticatorAttachment:_(l.authenticatorAttachment)}}const w="http://localhost:5000/api";function G(){const[e,t]=f.useState(""),[r,s]=f.useState(""),{login:o}=R(),[l,n]=f.useState(!1),c=async()=>{n(!0),s("");try{const i=await(await fetch(`${w}/auth/register/options`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e})})).json();let u;try{u=await H(i)}catch{throw new Error("Passkey creation cancelled or failed")}const d=await(await fetch(`${w}/auth/register/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,response:u})})).json();d.verified?o(d.token,e):s(d.error||"Registration failed")}catch(h){s(h.message)}finally{n(!1)}},m=async()=>{n(!0),s("");try{const h=await fetch(`${w}/auth/login/options`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e})});if(!h.ok)throw new Error("User not found");const i=await h.json();let u;try{u=await z(i)}catch{throw new Error("Login cancelled or failed")}const d=await(await fetch(`${w}/auth/login/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,response:u})})).json();d.verified?o(d.token,e):s(d.error||"Login failed")}catch(h){s(h.message)}finally{n(!1)}};return a.jsxs("div",{className:"flex flex-col gap-4 p-6 bg-white dark:bg-slate-800 rounded-lg shadow-xl w-80",children:[a.jsx("h2",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary",children:"Linko"}),a.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm",children:"Sign in securely with Passkeys"}),a.jsx("input",{type:"text",placeholder:"Username",className:"p-2 border border-slate-300 dark:border-slate-600 rounded bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-primary outline-none",value:e,onChange:h=>t(h.target.value)}),r&&a.jsx("p",{className:"text-red-500 text-xs",children:r}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:m,disabled:l||!e.trim(),className:"flex-1 bg-primary hover:bg-indigo-700 text-white py-2 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?"...":"Login"}),a.jsx("button",{onClick:c,disabled:l||!e.trim(),className:"flex-1 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 py-2 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Register"})]})]})}function q(){const{user:e,loading:t,logout:r}=R(),[s,o]=f.useState(null);return t?a.jsx("div",{className:"flex h-screen items-center justify-center",children:"Loading Linko..."}):e?a.jsxs("div",{className:"flex h-screen bg-gray-50 dark:bg-gray-900 text-slate-800 dark:text-slate-100 font-sans",children:[a.jsx(U,{selectedDirectory:s,onSelectDirectory:o}),a.jsxs("div",{className:"flex-1 flex flex-col h-screen overflow-hidden",children:[a.jsxs("header",{className:"h-16 bg-white dark:bg-slate-800 border-b border-slate-200 dark:bg-slate-700 flex items-center justify-between px-6 shadow-sm z-10",children:[a.jsx("h1",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary",children:"Linko"}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:()=>{chrome.storage.local.get("token",l=>{navigator.clipboard.writeText(l.token||""),alert("Token copied! Paste it in the Extension Popup.")})},className:"text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded hover:bg-indigo-200",children:"Copy Token"}),a.jsx("span",{className:"text-sm font-medium",children:e.username}),a.jsx("button",{onClick:r,className:"text-sm text-slate-500 hover:text-red-500",children:"Logout"})]})]}),a.jsx(K,{directoryId:s})]})]}):a.jsx("div",{className:"flex h-screen items-center justify-center bg-gray-50 dark:bg-gray-900",children:a.jsx(G,{})})}I.createRoot(document.getElementById("root")).render(a.jsx(O.StrictMode,{children:a.jsx(L,{children:a.jsx(q,{})})}));
